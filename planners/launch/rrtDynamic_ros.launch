<?xml version="1.0"?>

<launch>
  <param name="use_sim_time" value="true"/>

  <node pkg="stage_ros" type="stageros" name="stageros" args="-d $(find stage_simulation)/worlds/dynamic_obstacles_1.world">
    <!--remap from="tf" to="tf_old"/-->
  </node>
  <node pkg="map_server" name="map_server" type="map_server" args="$(find stage_simulation)/worlds/maps/test_map_2.pgm 0.050000">
    <!--remap from="/map" to="map"/-->
  </node>
  <!--node pkg="tf" type="tf_remap" name="tf_remap">
    <rosparam param="mappings">
      [{old: /robot_0/odom, new: robot_0/odom},{old: /robot_0/base_footprint, new: robot_0/base_footprint},{old: /robot_0/base_link, new: robot_0/base_link},{old: /robot_0/base_laser_link, new: robot_0/base_laser_link}]
    </rosparam>
  </node-->
  <node pkg="planners" type="remap_scan" name="remap_scan"/>
  <node pkg="planners" type="clear_scan" name="clear_scan">
    <param name="laser_frame_id" value="robot_0/base_laser_link"/>
    <param name="reduction_factor" value="0.1"/>
  </node>

  <group ns="robot_0">
    <!--param name="tf_prefix" value="robot_0"/-->
    <node pkg="amcl" type="amcl" name="amcl">
      <param name="use_map_topic" value="true"/>
      <param name="base_frame_id" value="robot_0/base_footprint"/>
      <param name="odom_frame_id" value="robot_0/odom"/>
      <param name="tf_broadcast" value="true"/>
      <param name="odom_model_type" value="diff-corrected"/>
      <param name="odom_alpha1" value="0.0"/>
      <param name="odom_alpha2" value="0.0"/>
      <param name="odom_alpha3" value="0.0"/>
      <param name="odom_alpha4" value="0.0"/>
      <remap from="scan" to="base_scan"/>
      <remap from="static_map" to="/static_map"/>
      <remap from="map" to="/map"/>
    </node>
    <node pkg="move_base" type="move_base" name="move_base" output="screen">
      <rosparam file="$(find planners)/launch/config/dynamic_costmap_common_params.yaml" command="load" ns="global_costmap"/>
      <rosparam file="$(find planners)/launch/config/dynamic_costmap_common_params.yaml" command="load" ns="local_costmap"/>
      <rosparam file="$(find planners)/launch/config/dynamic_local_costmap_params.yaml" command="load"/>
      <rosparam file="$(find planners)/launch/config/dynamic_global_costmap_params.yaml" command="load"/>
      <rosparam file="$(find planners)/launch/config/dynamic_local_planner_params.yaml" command="load"/>
      <param name="base_local_planner" value="rrt_planner/RRTPlanner"/>
      <remap from="/robot_0/move_base/RRTPlanner/robot_0/cmd_vel" to="cmd_vel"/>
      <remap from="map" to="/map"/>
    </node>
  </group>

  <!--group ns="robot_1">
    <node pkg="amcl" type="amcl" name="amcl">
      <param name="use_map_topic" value="true"/>
      <param name="base_frame_id" value="robot_1/base_footprint"/>
      <param name="odom_frame_id" value="robot_1/odom"/>
      <param name="tf_broadcast" value="true"/>
      <param name="odom_model_type" value="diff-corrected"/>
      <param name="odom_alpha1" value="0.0000000001"/>
      <param name="odom_alpha2" value="0.0000000001"/>
      <param name="odom_alpha3" value="0.0000000001"/>
      <param name="odom_alpha4" value="0.0000000001"/>
      <remap from="scan" to="base_scan"/>
      <remap from="static_map" to="/static_map"/>
      <remap from="map" to="/map"/>
    </node>
    <node pkg="planners" type="dynamic_obstacles" name="dynamic_obstacles">
      <remap from="/robot_1/dynamic_obstacles/cmd_vel" to="cmd_vel"/>
      <param name="obstacle_velocity" value="1.0"/>
      <param name="obstacle_steps" value="60"/>
    </node>
  </group>

  <group ns="robot_2">
    <node pkg="amcl" type="amcl" name="amcl">
      <param name="use_map_topic" value="true"/>
      <param name="base_frame_id" value="robot_2/base_footprint"/>
      <param name="odom_frame_id" value="robot_2/odom"/>
      <param name="tf_broadcast" value="true"/>
      <param name="odom_model_type" value="diff-corrected"/>
      <param name="odom_alpha1" value="0.0000000001"/>
      <param name="odom_alpha2" value="0.0000000001"/>
      <param name="odom_alpha3" value="0.0000000001"/>
      <param name="odom_alpha4" value="0.0000000001"/>
      <remap from="scan" to="base_scan"/>
      <remap from="static_map" to="/static_map"/>
      <remap from="map" to="/map"/>
    </node>
    <node pkg="planners" type="dynamic_obstacles" name="dynamic_obstacles">
      <param name="obstacle_velocity" value="1.0"/>
      <param name="obstacle_steps" value="60"/>
    </node>
  </group>

  <group ns="robot_3">
    <node pkg="amcl" type="amcl" name="amcl">
      <param name="use_map_topic" value="true"/>
      <param name="base_frame_id" value="robot_3/base_footprint"/>
      <param name="odom_frame_id" value="robot_3/odom"/>
      <param name="tf_broadcast" value="true"/>
      <param name="odom_model_type" value="diff-corrected"/>
      <param name="odom_alpha1" value="0.0000000001"/>
      <param name="odom_alpha2" value="0.0000000001"/>
      <param name="odom_alpha3" value="0.0000000001"/>
      <param name="odom_alpha4" value="0.0000000001"/>
      <remap from="scan" to="base_scan"/>
      <remap from="static_map" to="/static_map"/>
      <remap from="map" to="/map"/>
    </node>
    <node pkg="planners" type="dynamic_obstacles" name="dynamic_obstacles">
      <param name="obstacle_velocity" value="1.0"/>
      <param name="obstacle_steps" value="60"/>
    </node>
  </group>

  <group ns="robot_4">
    <node pkg="amcl" type="amcl" name="amcl">
      <param name="use_map_topic" value="true"/>
      <param name="base_frame_id" value="robot_4/base_footprint"/>
      <param name="odom_frame_id" value="robot_4/odom"/>
      <param name="tf_broadcast" value="true"/>
      <param name="odom_model_type" value="diff-corrected"/>
      <param name="odom_alpha1" value="0.0000000001"/>
      <param name="odom_alpha2" value="0.0000000001"/>
      <param name="odom_alpha3" value="0.0000000001"/>
      <param name="odom_alpha4" value="0.0000000001"/>
      <remap from="scan" to="base_scan"/>
      <remap from="static_map" to="/static_map"/>
      <remap from="map" to="/map"/>
    </node>
    <node pkg="planners" type="dynamic_obstacles" name="dynamic_obstacles">
      <param name="obstacle_velocity" value="1.0"/>
      <param name="obstacle_steps" value="60"/>
    </node>
  </group>

  <group ns="robot_5">
    <node pkg="amcl" type="amcl" name="amcl">
      <param name="use_map_topic" value="true"/>
      <param name="base_frame_id" value="robot_5/base_footprint"/>
      <param name="odom_frame_id" value="robot_5/odom"/>
      <param name="tf_broadcast" value="true"/>
      <param name="odom_model_type" value="diff-corrected"/>
      <param name="odom_alpha1" value="0.0000000001"/>
      <param name="odom_alpha2" value="0.0000000001"/>
      <param name="odom_alpha3" value="0.0000000001"/>
      <param name="odom_alpha4" value="0.0000000001"/>
      <remap from="scan" to="base_scan"/>
      <remap from="static_map" to="/static_map"/>
      <remap from="map" to="/map"/>
    </node>
    <node pkg="planners" type="dynamic_obstacles" name="dynamic_obstacles">
      <param name="obstacle_velocity" value="1.0"/>
      <param name="obstacle_steps" value="60"/>
    </node>
  </group>

  <group ns="robot_6">
    <node pkg="amcl" type="amcl" name="amcl">
      <param name="use_map_topic" value="true"/>
      <param name="base_frame_id" value="robot_6/base_footprint"/>
      <param name="odom_frame_id" value="robot_6/odom"/>
      <param name="tf_broadcast" value="true"/>
      <param name="odom_model_type" value="diff-corrected"/>
      <param name="odom_alpha1" value="0.0000000001"/>
      <param name="odom_alpha2" value="0.0000000001"/>
      <param name="odom_alpha3" value="0.0000000001"/>
      <param name="odom_alpha4" value="0.0000000001"/>
      <remap from="scan" to="base_scan"/>
      <remap from="static_map" to="/static_map"/>
      <remap from="map" to="/map"/>
    </node>
    <node pkg="planners" type="dynamic_obstacles" name="dynamic_obstacles">
      <param name="obstacle_velocity" value="1.0"/>
      <param name="obstacle_steps" value="60"/>
    </node>
  </group-->

  <node pkg="rviz" type="rviz" name="rviz">
    <remap from="initialpose" to="robot_0/initialpose"/><!--remap rviz initial position button-->
    <remap from="move_base_simple/goal" to="robot_0/move_base_simple/goal"/><!--remap rviz goal position button-->
  </node>

</launch>
